import { Selection } from './Selection'; import { createEditor } from '../editors/EditorFactory'; import { Renderer } from './Renderer'; import { ColumnDef } from '../types'; export class Grid { private selection: Selection; private renderer: Renderer; constructor(private container: HTMLElement, private columns: ColumnDef[], private rows: any[]) { this.selection = new Selection(); this.renderer = new Renderer(container, columns, rows); this.init(); } private init() { this.renderer.render(); this.container.addEventListener('dblclick', e => this.onDblClick(e)); } private onDblClick(e: MouseEvent) { const cell = (e.target as HTMLElement).closest('.ht-cell') as HTMLElement; if (!cell) return; const row = Number(cell.dataset['row']); const col = Number(cell.dataset['col']); const colDef = this.columns[col]; if (colDef.readOnly || colDef.type === 'readonly') return; const rect = cell.getBoundingClientRect(); const value = this.rows[row][colDef.key]; const editor = createEditor(colDef.type, document.body, val => { this.rows[row][colDef.key] = val; this.renderer.render(); editor.close(); }, () => editor.close()); editor.open(rect, value, colDef); } }